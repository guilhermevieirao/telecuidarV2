<div class="schedule-blocks-container">
  <div class="schedule-blocks__header">
    <div class="schedule-blocks__header-content">
      <app-icon name="clock" [size]="32" />
      <div>
        <h1 class="schedule-blocks__title">Meus Bloqueios de Agenda</h1>
        <p class="schedule-blocks__subtitle">Gerencie suas indisponibilidades e solicitações de bloqueio</p>
      </div>
    </div>
    <app-button (click)="openRequestModal()">
      <app-icon name="plus" [size]="20" />
      Solicitar Bloqueio
    </app-button>
  </div>

  <div class="blocks-grid">
    @if (isLoading) {
      <div class="empty-state">
        <p>Carregando bloqueios...</p>
      </div>
    } @else if (blocks.length === 0) {
      <div class="empty-state">
        <app-icon name="calendar" [size]="48" />
        <h3>Nenhum bloqueio encontrado</h3>
        <p>Você não possui solicitações de bloqueio de agenda.</p>
      </div>
    } @else {
      @for (block of blocks; track block.id) {
        <div class="block-card">
          <div class="block-header">
            <div class="date-info">
              @if (block.type === 'Single') {
                <span class="date">{{ formatDate(block.date!) }}</span>
                <span class="type">{{ getTypeLabel(block.type) }}</span>
              } @else {
                <span class="date">{{ formatDate(block.startDate!) }} - {{ formatDate(block.endDate!) }}</span>
                <span class="type">{{ getTypeLabel(block.type) }}</span>
              }
            </div>
            <app-badge [variant]="getStatusVariant(block.status)" [label]="getStatusLabel(block.status)" />
          </div>
          
          <div class="block-content">
            <p class="reason">{{ block.reason }}</p>
            <p class="meta">Solicitado em: {{ formatDate(block.createdAt) }}</p>
            @if (block.rejectionReason) {
              <p class="rejection-reason">Motivo da rejeição: {{ block.rejectionReason }}</p>
            }
          </div>
          
          @if (block.status === 'Pending') {
            <div class="block-actions">
              <app-button variant="danger" size="sm" (click)="cancelBlock(block)">
                <app-icon name="x-circle" [size]="16" />
                Cancelar Solicitação
              </app-button>
            </div>
          }
        </div>
      }
    }
  </div>
</div>

<app-schedule-block-request-modal
  [isOpen]="isRequestModalOpen"
  (close)="closeRequestModal()"
  (request)="handleRequest($event)"
/>
