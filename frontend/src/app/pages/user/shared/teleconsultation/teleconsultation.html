<div class="teleconsultation-container">
  <!-- Video Area with Jitsi Integration -->
  <div class="video-area">
    <!-- Jitsi Video Component (quando habilitado) -->
    <app-jitsi-video
      *ngIf="jitsiEnabled && appointmentId"
      [appointmentId]="appointmentId"
      [showControls]="true"
      (conferenceJoined)="onConferenceJoined($event)"
      (conferenceLeft)="onConferenceLeft($event)"
      (errorOccurred)="onJitsiError($event)"
      (callEnded)="onCallEnded()">
    </app-jitsi-video>

    <!-- Placeholder quando Jitsi não está habilitado -->
    <div class="placeholder-video" *ngIf="!jitsiEnabled">
      <app-icon name="video" [size]="64" />
      <p>Sistema de Videochamada</p>
      <p class="placeholder-subtitle" *ngIf="!jitsiEnabled">Jitsi não configurado. Configure o servidor Jitsi para habilitar videochamadas.</p>
      <div class="controls-overlay" *ngIf="!isHeaderVisible">
        <button class="icon-btn show-header-btn" (click)="toggleHeader()" title="Mostrar Cabeçalho">
          <app-icon name="chevron-down" [size]="24" />
        </button>
      </div>
    </div>

    <!-- Controls overlay para mostrar header quando Jitsi está ativo -->
    <div class="controls-overlay" *ngIf="jitsiEnabled && !isHeaderVisible">
      <button class="icon-btn show-header-btn" (click)="toggleHeader()" title="Mostrar Cabeçalho">
        <app-icon name="chevron-down" [size]="24" />
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="tele-header" [class.hidden]="!isHeaderVisible">
    <div class="header-content">
      <div class="info-section">
        <div class="main-info" *ngIf="appointment">
          <h2>{{ userrole === 'PROFESSIONAL' ? appointment.patientName : appointment.professionalName }}</h2>
          <span class="specialty-badge">{{ appointment.specialtyName }}</span>
        </div>
        <div class="main-info" *ngIf="!appointment">
          <h2>Carregando...</h2>
        </div>
        <div class="meta-info" *ngIf="appointment">
          <span><app-icon name="calendar" [size]="14" /> {{ appointment.date | date:'dd/MM/yyyy':'':'pt-BR' }}</span>
          <span><app-icon name="clock" [size]="14" /> {{ appointment.time }}</span>
        </div>
      </div>

      <div class="controls-section">
        <app-theme-toggle />
        <button class="icon-btn" (click)="toggleHeader()" title="Ocultar Cabeçalho">
          <app-icon name="chevron-up" [size]="20" />
        </button>
        <app-button variant="danger" size="sm" (click)="exitCall()">
          <app-icon name="arrow-left" [size]="18" />
          Sair
        </app-button>
      </div>
    </div>
  </div>

  <!-- Sidebar Toggle Button (Bottom Right) -->
  <button class="sidebar-toggle-btn" (click)="toggleSidebar()" *ngIf="!isSidebarOpen">
    <app-icon name="menu" [size]="24" />
  </button>

  <!-- Sidebar -->
  <app-teleconsultation-sidebar
    [isOpen]="isSidebarOpen"
    [isFullScreen]="isSidebarFull"
    [isHeaderVisible]="isHeaderVisible"
    [tabs]="currentTabs"
    [activeTab]="activeTab"
    [userrole]="userrole"
    [appointmentId]="appointmentId"
    [appointment]="appointment"
    (toggle)="toggleSidebar()"
    (toggleMode)="toggleSidebarMode()"
    (tabChange)="setActiveTab($event)"
    (finishConsultation)="onFinishConsultation($event)">
  </app-teleconsultation-sidebar>
</div>
